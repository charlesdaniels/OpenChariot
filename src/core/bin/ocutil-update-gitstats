#!/bin/sh

# update your gitstats static HTML pages.

$(ocutil-getconfig)
if [ $OC_MAGIC -ne "OpenChariot" ] ; then
	echo "PANIC: OC_MAGIC not defined, is ocutil-getconfig in PATH?"
	exit 1
fi

# dir where git repos live
OC_GIT_DIR=/opt/cls/git
OC_WWW_ROOT=/var/www
HTML_OUT_DIR="$OC_WWW_ROOT/gitstats"

PATH=$PATH:/opt/cls/bin

export GNUPLOT_DEFAULT_GDFONT=LiberationSans-Regular
export GDFONTPATH=/usr/share/fonts/liberation

for repo in "$OC_GIT_DIR/"*.git ; do
	name=$(basename "$repo" .git)
	OUT_DIR="$HTML_OUT_DIR/$name"
	mkdir -p "$OUT_DIR"
	echo "Processing repo $name..."
	gitstats "$repo" "$OUT_DIR"
done

echo "gitstats update complete"
